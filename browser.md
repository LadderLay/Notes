# 浏览器的基本工作原理（以 Chrome 为例）

## 浏览器的多进程架构
一个优秀的程序常常被划分为多个相互独立又彼此配合的模块，我们称之模块化。浏览器也是如此，以 Chrome 为例，它由多个进程组成，每个进程都有自己核心的职责，它们相互配合完成浏览器的整体功能，每个进程中又包含多个线程，一个进程内的多个线程也会协同工作，配合完成所在进程的职责。

### 进程与线程
在介绍进程和线程之前，先简单了解一下什么是并行处理，因为如果你理解了并行处理的概念，那么再理解进程和线程之间的关系就会变得轻松许多。
#### 并行处理

简单介绍两个概念：并发和并行。
1.（不那么准确的例子->
并发就是指指同时有很多事要做，你可以串行处理也可以并行处理。
并行是指同时做多件事。
2.（CSAPP上的解释

简单地说，计算机中的并行处理就是同一时刻处理多个任务。（dot）

`
A = 1+2     //task1
B = 20/5    //task2
C = 7*8     //task3
            //task4:show the result
`
**单线程**：分四步按照顺序分别执行这四个任务。
**多线程**：如果采用多线程，我们可以分“两步走”：第一步，使用三个线程同时执行前三个任务；第二步，再执行第四个显示任务。
因此，通过对比，你会发现使用多线程只需要两步。因此，使用并行处理能大大提升性能。
#### 进程（process）与线程（thread）
多线程可以并行处理任务，但是线程是不能单独存在的，它是由进程来启动和管理的。
一个进程就是一个程序的运行实例。
进程就像是一个有边界的生产厂间，而线程就像是厂间内的一个个员工，可以自己做自己的事情，也可以相互配合做同一件事情。

当我们启动一个应用，计算机会创建一个进程——操作系统会为进程分配一部分内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫进程。应用的所有状态都会保存在这块内存中，应用也许还会创建多个线程来辅助工作，这些线程可以共享这部分内存中的数据。如果应用关闭，进程会被终结，操作系统会释放相关内存。
一个进程还可以要求操作系统生成另一个进程来执行不同的任务，系统会为新的进程分配独立的内存，两个进程之间可以使用 IPC （Inter Process Communication）进行通信。很多应用都会采用这样的设计，如果一个工作进程反应迟钝，重启这个进程不会影响应用其它进程的工作。
（IPC通信）

### 从单进程浏览器走向多进程浏览器 
#### 单进程浏览器时代
在了解了进程和线程之后，我们可以来看一下浏览器的架构的一个演变。顾名思义，单进程浏览器是指**浏览器的所有功能模块都是运行在同一个进程里**，这些模块包含了网络、插件、JavaScript 运行环境、渲染引擎和页面等。其实早在 2007 年之前，市面上浏览器都是单进程的。单进程浏览器的架构如下图所示：
【】
这么多的功能模块运行在一个进程中，也是导致浏览器不稳定、不流畅的一个重要原因。
#### 多进程浏览器时代
- 早期的多进程
【】
上面这张图，是 2008 年 Chrome 发布时的进程架构。
从图中我们可以看到，由于进程之间是相互隔离的，所以当一个页面或者插件崩溃时，影响到的仅仅是当前的页面进程或者插件进程，并不会影响到浏览器和其他页面，从而提升了浏览器的稳定性。
此外，多进程的设计也使得 Chrome 采用了**安全沙箱**，
- 目前的多进程
【】
`show task manager`

- 未来面向服务的架构
【】

## 浏览器的渲染机制
